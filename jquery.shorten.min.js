/*
 * Shorten, a jQuery plugin to automatically shorten text to fit in a block or a pre-set width and configure how the text ends.
 * Copyright (C) 2009-2011  Marc Diethelm
 * License: (GPL 3, http://www.gnu.org/licenses/gpl-3.0.txt) see license.txt
 */
!function(t){function e(){var e=t(this),i=document.createElement("canvas");return ctx=i.getContext("2d"),e.html(i),ctx.font=e.css("font-style")+" "+e.css("font-variant")+" "+e.css("font-weight")+" "+Math.ceil(parseFloat(e.css("font-size")))+"px "+e.css("font-family"),ctx}function i(t,e){return e.measureText(t).width}function n(){var e="padding:0; margin:0; border:none; font:inherit;",i=t('<table style="'+e+'width:auto;zoom:1;position:absolute;"><tr style="'+e+'"><td style="'+e+'white-space:nowrap;"></td></tr></table>');return $td=t("td",i),t(this).html(i),$td}function o(t,e){return e.text(t),e.width()}function s(e,i){var n=t(e),o=t(i),s=o.offset().top-t(window).scrollTop()+o.outerHeight(),r=o.offset().left,a=o.outerWidth();n.css({position:"fixed",top:s+"px",left:r+"px",width:a+"px",zIndex:"9999"})}var r,a,l,h=!1,d="shorten-info",c="shorten-options";t.fn.shorten=function(){var e,i={},n=arguments,o=n.callee;if(n.length)if(n[0].constructor==Object)i=n[0];else{if("options"==n[0])return t(this).eq(0).data(c);i={width:parseInt(n[0],10),tail:n[1]}}return this.css("visibility","hidden"),e=t.extend({},o.defaults,i),this.each(function(){var n,s=t(this),r=s.text(),h=r.length,f=a.call(this),u=l.call(this,r,f),v=t("<span/>").html(e.tail).text(),p={shortened:!1,textOverflow:!1};if(n="none"!=s.css("float")?e.width||s.width():e.width||s.parent().width(),0>n)return!0;if(s.data(c,e),this.style.display="block",this.style.whiteSpace="nowrap",n>u)return s.text(r),this.style.visibility="visible",s.data(d)&&e.tooltip&&(s.removeAttr("title"),s.removeAttr("data-shorten-original")),s.data(d,p),!0;if(e.tooltip&&(e.popup!==!0?this.setAttribute("title",r):s.attr("data-shorten-original",r)),o._native&&!i.width){var x=t("<span>"+e.tail+"</span>").text();if(1==x.length&&8230==x.charCodeAt(0))return s.text(r),this.style.overflow="hidden",this.style[o._native]="ellipsis",this.style.visibility="visible",p.shortened=!0,p.textOverflow="ellipsis",s.data(d,p),!0}var m=l.call(this,v,f);n-=m;var w=1.15*n;if(u-w>0){var y=w/u,g=Math.ceil(h*y),b=r.substring(0,g),O=l.call(this,b,f);O>n&&(r=b,h=r.length)}do h--,r=r.substring(0,h);while(l.call(this,r,f)>=n);return s.html(t.trim(t("<span/>").text(r).html())+e.tail),this.style.visibility="visible",p.shortened=!0,s.data(d,p),!0})};var f=document.documentElement.style;if("textOverflow"in f?h="textOverflow":"OTextOverflow"in f&&(h="OTextOverflow"),"undefined"!=typeof Modernizr&&Modernizr.canvastext)r=Modernizr.canvastext;else{var u=document.createElement("canvas");r=!(!u.getContext||!u.getContext("2d")||"function"!=typeof u.getContext("2d").fillText)}t.fn.shorten._is_canvasTextSupported=r,t.fn.shorten._native=h,r?(a=e,l=i):(a=n,l=o),t.fn.shorten.defaults={tail:"&hellip;",tooltip:!0};var v="data-shorten-original",p=null;t(document).on("mouseover","["+v+"]",function(){var e=t(this);e.css("position","relative");var i=e.attr(v),n=t('<div class="jquery_shorten_tooltip_popup"></div>');n.text(i),s(n[0],e),t("body").append(n),p=n}),t(document).on("mouseout","["+v+"]",function(){p&&p.remove()})}(jQuery);
